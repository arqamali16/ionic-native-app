{"ast":null,"code":"import { __awaiter, __extends, __generator } from \"tslib\";\nimport { WebPlugin } from './index';\nimport { CameraResultType, CameraDirection, CameraSource } from '../core-plugin-definitions';\n\nvar CameraPluginWeb =\n/** @class */\nfunction (_super) {\n  __extends(CameraPluginWeb, _super);\n\n  function CameraPluginWeb() {\n    return _super.call(this, {\n      name: 'Camera',\n      platforms: ['web']\n    }) || this;\n  }\n\n  CameraPluginWeb.prototype.getPhoto = function (options) {\n    return __awaiter(this, void 0, void 0, function () {\n      var _this = this;\n\n      return __generator(this, function (_a) {\n        return [2\n        /*return*/\n        , new Promise(function (resolve, reject) {\n          return __awaiter(_this, void 0, void 0, function () {\n            var cameraModal_1, e_1;\n\n            var _this = this;\n\n            return __generator(this, function (_a) {\n              switch (_a.label) {\n                case 0:\n                  if (!options.webUseInput) return [3\n                  /*break*/\n                  , 1];\n                  this.fileInputExperience(options, resolve);\n                  return [3\n                  /*break*/\n                  , 7];\n\n                case 1:\n                  if (!customElements.get('pwa-camera-modal')) return [3\n                  /*break*/\n                  , 6];\n                  cameraModal_1 = document.createElement('pwa-camera-modal');\n                  document.body.appendChild(cameraModal_1);\n                  _a.label = 2;\n\n                case 2:\n                  _a.trys.push([2, 4,, 5]);\n\n                  return [4\n                  /*yield*/\n                  , cameraModal_1.componentOnReady()];\n\n                case 3:\n                  _a.sent();\n\n                  cameraModal_1.addEventListener('onPhoto', function (e) {\n                    return __awaiter(_this, void 0, void 0, function () {\n                      var photo, _a;\n\n                      return __generator(this, function (_b) {\n                        switch (_b.label) {\n                          case 0:\n                            photo = e.detail;\n                            if (!(photo === null)) return [3\n                            /*break*/\n                            , 1];\n                            reject('User cancelled photos app');\n                            return [3\n                            /*break*/\n                            , 4];\n\n                          case 1:\n                            if (!(photo instanceof Error)) return [3\n                            /*break*/\n                            , 2];\n                            reject(photo.message);\n                            return [3\n                            /*break*/\n                            , 4];\n\n                          case 2:\n                            _a = resolve;\n                            return [4\n                            /*yield*/\n                            , this._getCameraPhoto(photo, options)];\n\n                          case 3:\n                            _a.apply(void 0, [_b.sent()]);\n\n                            _b.label = 4;\n\n                          case 4:\n                            cameraModal_1.dismiss();\n                            document.body.removeChild(cameraModal_1);\n                            return [2\n                            /*return*/\n                            ];\n                        }\n                      });\n                    });\n                  });\n                  cameraModal_1.present();\n                  return [3\n                  /*break*/\n                  , 5];\n\n                case 4:\n                  e_1 = _a.sent();\n                  this.fileInputExperience(options, resolve);\n                  return [3\n                  /*break*/\n                  , 5];\n\n                case 5:\n                  return [3\n                  /*break*/\n                  , 7];\n\n                case 6:\n                  console.error(\"Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/pwa-elements.\");\n                  this.fileInputExperience(options, resolve);\n                  _a.label = 7;\n\n                case 7:\n                  return [2\n                  /*return*/\n                  ];\n              }\n            });\n          });\n        })];\n      });\n    });\n  };\n\n  CameraPluginWeb.prototype.fileInputExperience = function (options, resolve) {\n    var input = document.querySelector('#_capacitor-camera-input');\n\n    var cleanup = function () {\n      input.parentNode && input.parentNode.removeChild(input);\n    };\n\n    if (!input) {\n      input = document.createElement('input');\n      input.id = '_capacitor-camera-input';\n      input.type = 'file';\n      document.body.appendChild(input);\n    }\n\n    input.accept = 'image/*';\n    input.capture = true;\n\n    if (options.source === CameraSource.Photos || options.source === CameraSource.Prompt) {\n      input.removeAttribute('capture');\n    } else if (options.direction === CameraDirection.Front) {\n      input.capture = 'user';\n    } else if (options.direction === CameraDirection.Rear) {\n      input.capture = 'environment';\n    }\n\n    input.addEventListener('change', function (_e) {\n      var file = input.files[0];\n      var format = 'jpeg';\n\n      if (file.type === 'image/png') {\n        format = 'png';\n      } else if (file.type === 'image/gif') {\n        format = 'gif';\n      }\n\n      if (options.resultType === CameraResultType.DataUrl || options.resultType === CameraResultType.Base64) {\n        var reader_1 = new FileReader();\n        reader_1.addEventListener('load', function () {\n          if (options.resultType === CameraResultType.DataUrl) {\n            resolve({\n              dataUrl: reader_1.result,\n              format: format\n            });\n          } else if (options.resultType === CameraResultType.Base64) {\n            var b64 = reader_1.result.split(',')[1];\n            resolve({\n              base64String: b64,\n              format: format\n            });\n          }\n\n          cleanup();\n        });\n        reader_1.readAsDataURL(file);\n      } else {\n        resolve({\n          webPath: URL.createObjectURL(file),\n          format: format\n        });\n        cleanup();\n      }\n    });\n    input.click();\n  };\n\n  CameraPluginWeb.prototype._getCameraPhoto = function (photo, options) {\n    return new Promise(function (resolve, reject) {\n      var reader = new FileReader();\n      var format = photo.type.split('/')[1];\n\n      if (options.resultType === CameraResultType.Uri) {\n        resolve({\n          webPath: URL.createObjectURL(photo),\n          format: format\n        });\n      } else {\n        reader.readAsDataURL(photo);\n\n        reader.onloadend = function () {\n          var r = reader.result;\n\n          if (options.resultType === CameraResultType.DataUrl) {\n            resolve({\n              dataUrl: r,\n              format: format\n            });\n          } else {\n            resolve({\n              base64String: r.split(',')[1],\n              format: format\n            });\n          }\n        };\n\n        reader.onerror = function (e) {\n          reject(e);\n        };\n      }\n    });\n  };\n\n  return CameraPluginWeb;\n}(WebPlugin);\n\nexport { CameraPluginWeb };\nvar Camera = new CameraPluginWeb();\nexport { Camera };","map":{"version":3,"sources":["../../../src/web/camera.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { __awaiter, __extends, __generator } from \"tslib\";\nimport { WebPlugin } from './index';\nimport { CameraResultType, CameraDirection, CameraSource } from '../core-plugin-definitions';\nvar CameraPluginWeb = /** @class */ (function (_super) {\n    __extends(CameraPluginWeb, _super);\n    function CameraPluginWeb() {\n        return _super.call(this, {\n            name: 'Camera',\n            platforms: ['web']\n        }) || this;\n    }\n    CameraPluginWeb.prototype.getPhoto = function (options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            return __generator(this, function (_a) {\n                return [2 /*return*/, new Promise(function (resolve, reject) { return __awaiter(_this, void 0, void 0, function () {\n                        var cameraModal_1, e_1;\n                        var _this = this;\n                        return __generator(this, function (_a) {\n                            switch (_a.label) {\n                                case 0:\n                                    if (!options.webUseInput) return [3 /*break*/, 1];\n                                    this.fileInputExperience(options, resolve);\n                                    return [3 /*break*/, 7];\n                                case 1:\n                                    if (!customElements.get('pwa-camera-modal')) return [3 /*break*/, 6];\n                                    cameraModal_1 = document.createElement('pwa-camera-modal');\n                                    document.body.appendChild(cameraModal_1);\n                                    _a.label = 2;\n                                case 2:\n                                    _a.trys.push([2, 4, , 5]);\n                                    return [4 /*yield*/, cameraModal_1.componentOnReady()];\n                                case 3:\n                                    _a.sent();\n                                    cameraModal_1.addEventListener('onPhoto', function (e) { return __awaiter(_this, void 0, void 0, function () {\n                                        var photo, _a;\n                                        return __generator(this, function (_b) {\n                                            switch (_b.label) {\n                                                case 0:\n                                                    photo = e.detail;\n                                                    if (!(photo === null)) return [3 /*break*/, 1];\n                                                    reject('User cancelled photos app');\n                                                    return [3 /*break*/, 4];\n                                                case 1:\n                                                    if (!(photo instanceof Error)) return [3 /*break*/, 2];\n                                                    reject(photo.message);\n                                                    return [3 /*break*/, 4];\n                                                case 2:\n                                                    _a = resolve;\n                                                    return [4 /*yield*/, this._getCameraPhoto(photo, options)];\n                                                case 3:\n                                                    _a.apply(void 0, [_b.sent()]);\n                                                    _b.label = 4;\n                                                case 4:\n                                                    cameraModal_1.dismiss();\n                                                    document.body.removeChild(cameraModal_1);\n                                                    return [2 /*return*/];\n                                            }\n                                        });\n                                    }); });\n                                    cameraModal_1.present();\n                                    return [3 /*break*/, 5];\n                                case 4:\n                                    e_1 = _a.sent();\n                                    this.fileInputExperience(options, resolve);\n                                    return [3 /*break*/, 5];\n                                case 5: return [3 /*break*/, 7];\n                                case 6:\n                                    console.error(\"Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/pwa-elements.\");\n                                    this.fileInputExperience(options, resolve);\n                                    _a.label = 7;\n                                case 7: return [2 /*return*/];\n                            }\n                        });\n                    }); })];\n            });\n        });\n    };\n    CameraPluginWeb.prototype.fileInputExperience = function (options, resolve) {\n        var input = document.querySelector('#_capacitor-camera-input');\n        var cleanup = function () {\n            input.parentNode && input.parentNode.removeChild(input);\n        };\n        if (!input) {\n            input = document.createElement('input');\n            input.id = '_capacitor-camera-input';\n            input.type = 'file';\n            document.body.appendChild(input);\n        }\n        input.accept = 'image/*';\n        input.capture = true;\n        if (options.source === CameraSource.Photos || options.source === CameraSource.Prompt) {\n            input.removeAttribute('capture');\n        }\n        else if (options.direction === CameraDirection.Front) {\n            input.capture = 'user';\n        }\n        else if (options.direction === CameraDirection.Rear) {\n            input.capture = 'environment';\n        }\n        input.addEventListener('change', function (_e) {\n            var file = input.files[0];\n            var format = 'jpeg';\n            if (file.type === 'image/png') {\n                format = 'png';\n            }\n            else if (file.type === 'image/gif') {\n                format = 'gif';\n            }\n            if (options.resultType === CameraResultType.DataUrl || options.resultType === CameraResultType.Base64) {\n                var reader_1 = new FileReader();\n                reader_1.addEventListener('load', function () {\n                    if (options.resultType === CameraResultType.DataUrl) {\n                        resolve({\n                            dataUrl: reader_1.result,\n                            format: format\n                        });\n                    }\n                    else if (options.resultType === CameraResultType.Base64) {\n                        var b64 = reader_1.result.split(',')[1];\n                        resolve({\n                            base64String: b64,\n                            format: format\n                        });\n                    }\n                    cleanup();\n                });\n                reader_1.readAsDataURL(file);\n            }\n            else {\n                resolve({\n                    webPath: URL.createObjectURL(file),\n                    format: format\n                });\n                cleanup();\n            }\n        });\n        input.click();\n    };\n    CameraPluginWeb.prototype._getCameraPhoto = function (photo, options) {\n        return new Promise(function (resolve, reject) {\n            var reader = new FileReader();\n            var format = photo.type.split('/')[1];\n            if (options.resultType === CameraResultType.Uri) {\n                resolve({\n                    webPath: URL.createObjectURL(photo),\n                    format: format\n                });\n            }\n            else {\n                reader.readAsDataURL(photo);\n                reader.onloadend = function () {\n                    var r = reader.result;\n                    if (options.resultType === CameraResultType.DataUrl) {\n                        resolve({\n                            dataUrl: r,\n                            format: format\n                        });\n                    }\n                    else {\n                        resolve({\n                            base64String: r.split(',')[1],\n                            format: format\n                        });\n                    }\n                };\n                reader.onerror = function (e) {\n                    reject(e);\n                };\n            }\n        });\n    };\n    return CameraPluginWeb;\n}(WebPlugin));\nexport { CameraPluginWeb };\nvar Camera = new CameraPluginWeb();\nexport { Camera };\n//# sourceMappingURL=camera.js.map"]},"metadata":{},"sourceType":"module"}